# Документация проекта

## Описание
Проект представляет собой FastAPI/Starlette веб-приложение для скачивания видео. Основные возможности:
- Скачивание видео с YouTube и других поддерживаемых платформ
- Поддержка HLS потоков (m3u8)
- Интеграция с ffmpeg и yt-dlp
- Отслеживание прогресса загрузки в реальном времени через SSE
- Управление загрузками через REST API
- Автоматическая очистка загруженных файлов
- Обработка ошибок и логирование

## Технический стек
- Python 3.9+
- FastAPI 0.109.1
- Starlette 0.35.1
- yt-dlp 2024.3.10
- FFmpeg
- Uvicorn 0.23.2
- Pydantic для валидации данных
- Pytest для тестирования

## API Endpoints
- `GET /` - Главная страница
- `POST /download` - Начать загрузку видео
- `GET /progress_stream/{download_id}` - SSE поток прогресса загрузки
- `GET /progress/{download_id}` - Получить текущий прогресс
- `GET /sync_progress?download_id={id}` - Синхронный запрос прогресса
- `GET /download_file/{download_id}` - Скачать готовый файл
- `POST /cancel/{download_id}` - Отменить загрузку
- `POST /log_error` - Логирование ошибок клиента

## Структура проекта
```
.
├── app.py               # Основной файл приложения с API endpoints
├── models.py           # Pydantic модели для валидации
├── requirements.txt    # Зависимости проекта
├── pyproject.toml     # Конфигурация Poetry и зависимости
├── test_app.py        # Тесты API endpoints
├── test_models.py     # Тесты моделей данных
├── downloads/         # Папка для временных файлов
├── static/            # Статические файлы
│   └── style.css     # Стили
├── views/            # Шаблоны
│   └── index.html    # Главная страница
└── README.md         # Документация
```

## Установка

### Через Poetry (рекомендуется)
```bash
# Установка зависимостей
poetry install

# Запуск
poetry run python app.py
```

### Через pip
```bash
pip install -r requirements.txt
python app.py
```

## Тестирование
Проект включает комплексный набор тестов:
- Тесты API endpoints (test_app.py)
- Тесты моделей данных (test_models.py)
- Тесты загрузки с разных платформ
- Тесты обработки ошибок

Запуск тестов:
```bash
pytest
```

## Принцип работы

### Процесс загрузки
1. Клиент отправляет URL видео через API
2. Сервер создает уникальный ID загрузки
3. В фоновом режиме запускается загрузка:
   - YouTube/Vimeo через yt-dlp
   - HLS потоки через FFmpeg
4. Прогресс отслеживается через SSE
5. Готовый файл доступен для скачивания
6. Файл автоматически удаляется через 60 секунд после скачивания

### Безопасность
- Валидация входных данных через Pydantic
- Ограничение доступа только с localhost
- Автоматическая очистка временных файлов
- Логирование всех операций
- Ротация логов каждые 24 часа

## Автор
Vnedrenec
